<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Genesis - Creature Creator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@300;400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0f 50%, #0f0a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background particles */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(139, 0, 0, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
            50% { transform: translateY(-100px) translateX(50px); opacity: 0.6; }
        }

        /* Landing Page */
        .landing {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
        }

        .landing h1 {
            font-family: 'Cinzel', serif;
            font-size: 5rem;
            font-weight: 700;
            color: #8b0000;
            text-shadow: 0 0 20px rgba(139, 0, 0, 0.8), 0 0 40px rgba(139, 0, 0, 0.4);
            margin-bottom: 1rem;
            letter-spacing: 0.3rem;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(139, 0, 0, 0.8), 0 0 40px rgba(139, 0, 0, 0.4); }
            50% { text-shadow: 0 0 30px rgba(139, 0, 0, 1), 0 0 60px rgba(139, 0, 0, 0.6); }
        }

        .landing p {
            font-size: 1.8rem;
            color: #999;
            margin-bottom: 3rem;
            font-style: italic;
        }

        .start-btn {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            padding: 1.5rem 4rem;
            background: linear-gradient(135deg, #8b0000, #4a0000);
            border: 2px solid #8b0000;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.2rem;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .start-btn:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .start-btn:hover:before {
            width: 300px;
            height: 300px;
        }

        .start-btn:hover {
            box-shadow: 0 0 40px rgba(139, 0, 0, 0.8);
            transform: translateY(-2px);
        }

        /* Creator Screen */
        .creator {
            display: none;
            position: relative;
            z-index: 1;
            padding: 2rem;
            min-height: 100vh;
        }

        .creator.active {
            display: block;
        }

        .creator-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .creator-header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            color: #8b0000;
            text-shadow: 0 0 10px rgba(139, 0, 0, 0.6);
        }

        .creator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Left Panel - Traits */
        .traits-panel {
            background: rgba(20, 10, 15, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 0, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .trait-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(139, 0, 0, 0.2);
        }

        .trait-section:last-child {
            border-bottom: none;
        }

        .trait-section h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            color: #8b0000;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.1rem;
        }

        .trait-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .trait-value {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(139, 0, 0, 0.3);
            min-height: 50px;
            display: flex;
            align-items: center;
            color: #ccc;
            font-size: 1.1rem;
        }

        .roll-btn {
            font-family: 'Cinzel', serif;
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, #4a0000, #2a0000);
            border: 1px solid #8b0000;
            color: #fff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.1rem;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
        }

        .roll-btn:hover {
            background: linear-gradient(135deg, #6a0000, #4a0000);
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.6);
            transform: translateY(-2px);
        }

        .roll-all-btn {
            width: 100%;
            padding: 1.2rem;
            font-size: 1.2rem;
            margin-top: 1rem;
            background: linear-gradient(135deg, #8b0000, #4a0000);
            letter-spacing: 0.2rem;
        }

        .roll-all-btn:hover {
            background: linear-gradient(135deg, #a00000, #6a0000);
        }

        /* Right Panel - Preview */
        .preview-panel {
            background: rgba(20, 10, 15, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 0, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .name-input-section {
            width: 100%;
            margin-bottom: 2rem;
        }

        .name-input-section h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            color: #8b0000;
            margin-bottom: 1rem;
            text-transform: uppercase;
            text-align: center;
        }

        .name-input-group {
            display: flex;
            gap: 1rem;
        }

        .name-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(139, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: #e0e0e0;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            text-align: center;
        }

        .name-input::placeholder {
            color: #666;
        }

        .preview-card {
            width: 100%;
            max-width: 500px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(139, 0, 0, 0.4);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .preview-card:before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 0, 0, 0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .creature-name {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: #8b0000;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(139, 0, 0, 0.6);
            position: relative;
            z-index: 1;
        }

        .image-placeholder {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(139, 0, 0, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .image-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .placeholder-text {
            color: #666;
            font-size: 1.2rem;
            font-style: italic;
        }

        .loading-animation {
            width: 100px;
            height: 100px;
            border: 3px solid rgba(139, 0, 0, 0.3);
            border-top: 3px solid #8b0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .create-btn, .regenerate-btn, .download-btn {
            flex: 1;
            font-family: 'Cinzel', serif;
            padding: 1rem;
            border: 1px solid #8b0000;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 1rem;
            letter-spacing: 0.1rem;
        }

        .create-btn {
            background: linear-gradient(135deg, #8b0000, #4a0000);
            color: #fff;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
        }

        .create-btn:hover {
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.8);
            transform: translateY(-2px);
        }

        .regenerate-btn, .download-btn {
            background: rgba(0, 0, 0, 0.5);
            color: #8b0000;
            display: none;
        }

        .regenerate-btn:hover, .download-btn:hover {
            background: rgba(139, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        /* Result Screen */
        .result {
            display: none;
            position: relative;
            z-index: 1;
            padding: 2rem;
            min-height: 100vh;
        }

        .result.active {
            display: block;
        }

        .result-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .result-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .result-header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            color: #8b0000;
            text-shadow: 0 0 20px rgba(139, 0, 0, 0.8);
            margin-bottom: 1rem;
        }

        .creature-card {
            background: rgba(20, 10, 15, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(139, 0, 0, 0.4);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
        }

        .card-top {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .card-image {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(139, 0, 0, 0.3);
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .card-info h2 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: #8b0000;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(139, 0, 0, 0.6);
        }

        .biography {
            background: rgba(0, 0, 0, 0.5);
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 3px solid #8b0000;
            margin-bottom: 2rem;
        }

        .biography h3 {
            font-family: 'Cinzel', serif;
            color: #8b0000;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .biography p {
            line-height: 1.8;
            font-size: 1.2rem;
            color: #ccc;
            font-style: italic;
        }

        .attributes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .attribute {
            background: rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
            border-radius: 10px;
            border: 1px solid rgba(139, 0, 0, 0.3);
        }

        .attribute h4 {
            font-family: 'Cinzel', serif;
            color: #8b0000;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.1rem;
        }

        .attribute p {
            color: #aaa;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .result-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 3rem;
            justify-content: center;
        }

        .result-btn {
            font-family: 'Cinzel', serif;
            padding: 1.2rem 3rem;
            background: linear-gradient(135deg, #8b0000, #4a0000);
            border: 1px solid #8b0000;
            color: #fff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 1.1rem;
            letter-spacing: 0.15rem;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
        }

        .result-btn:hover {
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.8);
            transform: translateY(-2px);
        }

        .back-btn {
            background: rgba(0, 0, 0, 0.5);
            color: #8b0000;
        }

        .back-btn:hover {
            background: rgba(139, 0, 0, 0.2);
        }

        @media (max-width: 1200px) {
            .creator-grid {
                grid-template-columns: 1fr;
            }
            
            .card-top {
                grid-template-columns: 1fr;
            }
            
            .attributes-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .landing h1 {
                font-size: 3rem;
            }
            
            .result-header h1 {
                font-size: 2.5rem;
            }
        }

        /* üåô MOBILE-FRIENDLY FIXES */
@media (max-width: 900px) {
    .landing h1 {
        font-size: 3rem;
        letter-spacing: 0.1rem;
    }

    .landing p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
    }

    .start-btn {
        font-size: 1.2rem;
        padding: 1rem 2.5rem;
    }

    .creator-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
        padding: 1rem;
    }

    .traits-panel, .preview-panel {
        padding: 1.2rem;
    }

    .trait-section h3 {
        font-size: 1.1rem;
    }

    .trait-value {
        font-size: 0.9rem;
        min-height: 40px;
        padding: 0.8rem;
    }

    .roll-btn {
        font-size: 0.8rem;
        padding: 0.6rem 1rem;
    }

    .preview-card {
        max-width: 100%;
        padding: 1rem;
    }

    .creature-name {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .image-placeholder {
        height: 250px;
    }

    .action-buttons {
        flex-direction: column;
    }

    .create-btn, .regenerate-btn, .download-btn {
        font-size: 0.9rem;
        padding: 0.8rem;
    }

    .result-header h1 {
        font-size: 2.2rem;
    }

    .card-top {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .card-image {
        height: 300px;
    }

    .biography h3 {
        font-size: 1.1rem;
    }

    .biography p {
        font-size: 0.9rem;
        line-height: 1.5;
    }

    .attributes-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .attribute {
        padding: 1rem;
    }

    .result-buttons {
        flex-direction: column;
        gap: 0.8rem;
    }

    .result-btn {
        width: 100%;
        font-size: 1rem;
    }
}

@media (max-width: 500px) {
    .landing h1 {
        font-size: 2.2rem;
    }

    .landing p {
        font-size: 1rem;
    }

    .start-btn {
        font-size: 1rem;
        padding: 0.8rem 2rem;
    }

    .image-placeholder {
        height: 220px;
    }

    .preview-card {
        padding: 0.8rem;
    }

    .creator-header h1 {
        font-size: 2rem;
    }
}

    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-particles" id="particles"></div>

    <!-- Landing Page -->
    <div class="landing" id="landing">
        <h1>DARK GENESIS</h1>
        <p>Forge your nightmare. One roll at a time.</p>
        <button class="start-btn" onclick="showCreator()">Start Creating</button>
    </div>

    <!-- Creator Screen -->
    <div class="creator" id="creator">
        <div class="creator-header">
            <h1>CREATURE CREATOR</h1>
        </div>
        
        <div class="creator-grid">
            <!-- Left Panel - Traits -->
            <div class="traits-panel">
                <div class="trait-section">
                    <h3>Core Monster Category</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="category-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('category')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Tier Ranking</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="tier-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('tier')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Physical Features</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="physical-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('physical')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Origin / Backstory</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="origin-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('origin')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Powers & Abilities</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="powers-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('powers')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Weaknesses</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="weakness-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('weakness')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Personality / Behavior</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="personality-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('personality')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Setting / Domain</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="setting-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('setting')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Sound & Atmosphere</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="sound-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('sound')">Roll</button>
                    </div>
                </div>

                <div class="trait-section">
                    <h3>Signature / Trophy</h3>
                    <div class="trait-content">
                        <div class="trait-value" id="signature-value">Click roll to begin...</div>
                        <button class="roll-btn" onclick="rollTrait('signature')">Roll</button>
                    </div>
                </div>

                <button class="roll-btn roll-all-btn" onclick="rollAll()">Roll All</button>
            </div>

            <!-- Right Panel - Preview -->
            <div class="preview-panel">
                <div class="name-input-section">
                    <h3>Creature Name</h3>
                    <div class="name-input-group">
                        <input type="text" class="name-input" id="creature-name-input" placeholder="Enter name or generate...">
                        <button class="roll-btn" onclick="generateName()">Generate</button>
                    </div>
                </div>

                <div class="preview-card">
                    <h2 class="creature-name" id="preview-name">Unnamed Horror</h2>
                    <div class="image-placeholder" id="image-container">
                        <span class="placeholder-text">Your creature awaits...</span>
                    </div>
                    <div class="action-buttons">
                        <button class="create-btn" onclick="createCreature()">Create Creature</button>
                        <button class="regenerate-btn" id="regenerate-btn" onclick="regenerateImage()">Regenerate Image</button>
                        <button class="download-btn" id="download-btn" onclick="downloadCard()">Download Card</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div class="result" id="result">
        <div class="result-container">
            <div class="result-header">
                <h1 id="result-creature-name">The Horror Awakens</h1>
            </div>
            
            <div class="creature-card" id="creature-card">
                <div class="card-top">
                    <div class="card-image" id="result-image-container">
                        <img src="" alt="Creature" id="result-image">
                    </div>
                    <div class="card-info">
                        <h2 id="result-name-display"></h2>
                        <div class="biography">
                            <h3>Biography</h3>
                            <p id="biography-text"></p>
                        </div>
                    </div>
                </div>

                <div class="attributes-grid" id="attributes-container">
                    <!-- Attributes will be populated here -->
                </div>
            </div>

            <div class="result-buttons">
                <button class="result-btn back-btn" onclick="backToCreator()">Create Another</button>
                <button class="result-btn" onclick="regenerateImage()">Regenerate Image</button>
                <button class="result-btn" onclick="downloadCard()">Download Card</button>
            </div>
        </div>
    </div>

    <script>
        // Data arrays (10 items each)
        const creatureData = {
            category: [
                "Ghost / Vengeful Spirit",
                "Demon / Hellspawn",
                "Undead Abomination",
                "Vampire Lord",
                "Werecreature / Shapeshifter",
                "Alien Entity",
                "Mutant Experiment",
                "Deep Sea Leviathan",
                "Ancient Warlock",
                "Possessed Marionette"
            ],
            tier: [
                { name: "Tier 1: Wretch", desc: "Lesser spawn, numerous but weak" },
                { name: "Tier 1: Crawler", desc: "Scavenging drone, pack hunter" },
                { name: "Tier 2: Stalker", desc: "Hunter with basic intelligence" },
                { name: "Tier 2: Reaver", desc: "Deadly prowler, hunts alone" },
                { name: "Tier 3: Warbringer", desc: "Elite champion with unique powers" },
                { name: "Tier 3: Archfiend", desc: "Powerful leader of horrors" },
                { name: "Tier 4: Nightmare Lord", desc: "Apex predator, one-of-a-kind" },
                { name: "Tier 4: Void Tyrant", desc: "Controls entire regions" },
                { name: "Tier 5: Elder Deity", desc: "God-like, reality-bending" },
                { name: "Tier 5: Cosmic Devourer", desc: "Myth given flesh, world-ender" }
            ],
            physical: [
                "Glowing crimson eyes, translucent skin revealing pulsing veins, elongated claws dripping ichor",
                "Dozens of unblinking eyes covering its torso, jagged bone spikes erupting from spine",
                "Cracked porcelain skin, jaw that unhinges revealing rows of needle teeth, shadowy tendrils for hair",
                "Crystalline growths pulsing with inner light, skeletal wings of tattered membrane",
                "Multiple faces embedded in flesh whispering secrets, arms that stretch unnaturally long",
                "Body stitched together with barbed wire, hollow chest with swirling darkness, reversed fingers",
                "Skin etched with glowing arcane runes, spider-like legs erupting from back, metallic bones beneath flesh",
                "Constantly shifting and reforming flesh, eyes that weep black tears, ribcage that opens like jaws",
                "Transparent body revealing organs, moth-like wings with eyes upon them, forked serpentine tongue",
                "Head replaced by flickering lantern, exposed heart glowing through chest, limbs wrapped in living chains",
                "Flesh covered in writhing maggots, mouth filled with broken glass shards, skin dripping black tar",
                "Antlers made of twisted bone growing from skull, face split vertically revealing void inside, clawed feet leaving smoking footprints",
                "Body composed of living shadows with glowing white cracks, extra joints bending wrong direction, fingers ending in syringes",
                "Covered in scales that shift colors like oil slicks, three mouths stacked vertically, arms splitting into tentacles at elbows",
                "Skin made of overlapping rusty metal plates, bleeding from every seam, head rotating 360 degrees continuously",
                "Face covered by blank wooden mask fused to skull, body leaking green luminescent fluid, hands with too many knuckles",
                "Chest cavity opened displaying clockwork mechanisms inside, skin pale blue and frozen, breath forming ice crystals",
                "Covered in thick matted fur with human hands poking through, elongated neck like a serpent, jaw detaches completely when feeding",
                "Body sections connected by chains of vertebrae, skin transparent showing moving organs, eyes replaced by empty bleeding sockets",
                "Flesh appears to be melting continuously but reforms, covered in tribal scars that glow red, mouth extends from ear to ear"
            ],
            origin: [
                "Born from a catastrophic ritual gone wrong, cursed to eternally hunger",
                "Ancient guardian awakened after millennia of slumber beneath forgotten ruins",
                "Manifestation of collective human fear and guilt, given horrific form",
                "Failed government experiment, escaped from a facility buried deep underground",
                "Summoned by forbidden texts, bound to serve but twisted by resentment",
                "Emerged from an abyssal ocean trench where reality grows thin",
                "Spirit trapped between worlds after a violent, unresolved death",
                "Alien parasite that merged with its host, creating something neither",
                "Created by nuclear mutation in the aftermath of catastrophic radiation",
                "Witch's curse given flesh, seeking vengeance across generations"
            ],
            powers: [
                "Shadow duplication - creates horrific copies of itself from darkness",
                "Dream walking - invades and kills victims within their nightmares",
                "Possession - takes control of minds, leaving victims aware but helpless",
                "Phase shifting - walks through solid walls and becomes intangible",
                "Fear projection - feeds on terror, growing stronger from victims' dread",
                "Blood manipulation - controls the blood within living creatures",
                "Memory leeching - steals or erases memories with a touch",
                "Reality distortion - warps perception, making victims see nightmares as reality",
                "Regeneration - rapidly heals from any wound, nearly immortal",
                "Telepathic whispers - implants maddening thoughts directly into minds"
            ],
            weakness: [
                "Sunlight causes its flesh to burn and petrify into ash",
                "Silver weapons nullify its regeneration and cause grievous wounds",
                "Cannot cross running water or enter without invitation",
                "Must feed nightly on fear or turns to dust by dawn",
                "Bound to its summoning location, cannot stray far from birthplace",
                "True name spoken aloud shatters its physical form",
                "Fire purifies its corruption, the only thing it truly fears",
                "Vulnerable only when seen in mirrors or reflective surfaces",
                "Holy ground repels it, causing intense agony upon approach",
                "Heart located outside body in hidden relic - destroy to kill permanently"
            ],
            personality: [
                "Sadistic and playful, toys with victims before the final strike",
                "Silent stalker that observes prey for days, learning their patterns",
                "Vengeful spirit obsessed with punishing the guilty and sinners",
                "Melancholic entity that regrets every kill but cannot stop its nature",
                "Cunning manipulator that turns allies against each other",
                "Chaotic destroyer driven by pure rage and hatred for the living",
                "Curious observer of humanity, studies victims like specimens",
                "Speaks only in riddles and backward prophecies",
                "Collects trophies and memories from each victim obsessively",
                "Believes it is still human, confused by its monstrous urges"
            ],
            setting: [
                "Abandoned asylum with corridors that shift and change",
                "Fog-shrouded graveyard where the dead whisper warnings",
                "Ancient cathedral ruins beneath which darker things dwell",
                "Cursed forest where trees bleed and shadows move independently",
                "Derelict space station drifting through the cosmic void",
                "Deep ocean trench where pressure and darkness reign eternal",
                "Decaying carnival grounds frozen in perpetual midnight",
                "Mirror realm accessible only through reflections at certain hours",
                "Subterranean laboratory complex filled with failed experiments",
                "Burned village that exists simultaneously in past and present"
            ],
            sound: [
                "Whispers in dead languages that echo seconds after it moves",
                "Wet breathing and clicking mandibles like insects",
                "Static and distorted radio chatter from nowhere",
                "Children's lullaby sung backward in a broken voice",
                "Low mechanical hum that vibrates through bone",
                "Footsteps that arrive before the creature appears",
                "Wind chimes made from bones rattling in still air",
                "Heartbeat growing louder as it draws near",
                "Screams of past victims replaying in endless loop",
                "Complete, oppressive silence that swallows all sound"
            ],
            signature: [
                "Leaves carved runes in the flesh of victims",
                "Collects the eyes of those it kills, preserving them in jars",
                "Replaces victims with wooden dolls in their exact likeness",
                "Draws circles of ash around murder sites",
                "Drains all color from the area, leaving only grayscale",
                "Leaves behind black feathers that burn to the touch",
                "Arranges bones into intricate geometric patterns",
                "Writes prophecies in blood on nearby walls",
                "Steals one specific item from each victim (locket, photograph, etc.)",
                "Victims found with expressions of pure terror frozen on faces"
            ]
        };

        // Name generation data
        const namePrefixes = ["Mor", "Zar", "Kael", "Vex", "Dra", "Nym", "Vor", "Ash", "Xer", "Vel"];
        const nameSuffixes = ["oth", "ath", "eth", "rath", "vorn", "thir", "gorn", "kar", "dros", "ion"];
        const titles = [
            "The Warden of Echoes",
            "The Shattered Choir",
            "Queen of Rust",
            "The Hollowed Prophet",
            "Bringer of Silence",
            "The Eternal Mourner",
            "Devourer of Light",
            "The Crimson Shepherd",
            "Keeper of Forgotten Names",
            "The Thirsting Shadow"
        ];

        // Current selections
        let currentTraits = {
            category: null,
            tier: null,
            physical: null,
            origin: null,
            powers: null,
            weakness: null,
            personality: null,
            setting: null,
            sound: null,
            signature: null
        };

        let currentName = "";
        let currentImage = "";
        let currentBio = "";

        // Initialize particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 100 + 50 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                container.appendChild(particle);
            }
        }

        createParticles();

        // Show creator screen
        function showCreator() {
            document.getElementById('landing').style.display = 'none';
            document.getElementById('creator').classList.add('active');
        }

        // Roll individual trait
        function rollTrait(trait) {
            const data = creatureData[trait];
            const random = data[Math.floor(Math.random() * data.length)];
            
            if (trait === 'tier') {
                currentTraits[trait] = random;
                document.getElementById(`${trait}-value`).textContent = random.name + " - " + random.desc;
            } else {
                currentTraits[trait] = random;
                document.getElementById(`${trait}-value`).textContent = random;
            }
        }

        // Roll all traits
        function rollAll() {
            Object.keys(creatureData).forEach(trait => {
                rollTrait(trait);
            });
        }

        // Generate creature name
        function generateName() {
            const useTitle = Math.random() < 0.25; // 25% chance for title format
            
            if (useTitle) {
                currentName = titles[Math.floor(Math.random() * titles.length)];
            } else {
                const prefix = namePrefixes[Math.floor(Math.random() * namePrefixes.length)];
                const suffix = nameSuffixes[Math.floor(Math.random() * nameSuffixes.length)];
                currentName = prefix + suffix;
            }
            
            document.getElementById('creature-name-input').value = currentName;
            document.getElementById('preview-name').textContent = currentName;
        }

        // Update preview name when user types
        document.getElementById('creature-name-input').addEventListener('input', function(e) {
            currentName = e.target.value || "Unnamed Horror";
            document.getElementById('preview-name').textContent = currentName;
        });

        // Generate biography
        function generateBiography() {
            const templates = [
                `Whispers in the dark speak of ${currentName}, ${currentTraits.category ? 'a ' + currentTraits.category : 'an ancient horror'} ${currentTraits.origin ? currentTraits.origin.toLowerCase() : 'of unknown origin'}. Those who encounter its ${currentTraits.physical ? currentTraits.physical.toLowerCase() : 'terrifying form'} rarely live to tell the tale. It ${currentTraits.personality ? currentTraits.personality.toLowerCase() : 'hunts without mercy'}, wielding ${currentTraits.powers ? currentTraits.powers.toLowerCase() : 'unnatural powers'}. Few know that ${currentTraits.weakness ? currentTraits.weakness.toLowerCase() : 'it can be stopped'}, but none dare to try.`,
                
                `In ${currentTraits.setting ? currentTraits.setting.toLowerCase() : 'the forgotten places'}, legends speak of ${currentName}. ${currentTraits.origin ? currentTraits.origin : 'Its origin is shrouded in mystery'}. Marked by ${currentTraits.physical ? currentTraits.physical.toLowerCase() : 'horrific features'}, it ${currentTraits.personality ? currentTraits.personality.toLowerCase() : 'stalks its prey relentlessly'}. The sound of ${currentTraits.sound ? currentTraits.sound.toLowerCase() : 'its approach'} heralds doom. Those who face it discover too late that ${currentTraits.powers ? currentTraits.powers.toLowerCase() : 'it possesses terrible abilities'}.`,
                
                `${currentName} dwells in ${currentTraits.setting ? currentTraits.setting.toLowerCase() : 'darkness itself'}. ${currentTraits.origin ? currentTraits.origin : 'No one knows where it came from'}. Its ${currentTraits.physical ? currentTraits.physical.toLowerCase() : 'nightmarish appearance'} haunts the dreams of survivors. The creature ${currentTraits.personality ? currentTraits.personality.toLowerCase() : 'shows no mercy'}, using ${currentTraits.powers ? currentTraits.powers.toLowerCase() : 'powers beyond comprehension'}. ${currentTraits.signature ? currentTraits.signature : 'It leaves no trace of its victims'}. Some say ${currentTraits.weakness ? currentTraits.weakness.toLowerCase() + ' may stop it' : 'there is no escape'}.`
            ];
            
            currentBio = templates[Math.floor(Math.random() * templates.length)];
            return currentBio;
        }

        // Generate AI prompt for image
        function generateImagePrompt() {
            const cameraAngles = ['full body portrait', 'dramatic low angle', 'cinematic close-up', 'three-quarter view'];
            const lightingMoods = ['moonlit', 'torchlit shadows', 'bioluminescent glow', 'fog-hazed darkness', 'crimson backlight'];
            const angle = cameraAngles[Math.floor(Math.random() * cameraAngles.length)];
            const lighting = lightingMoods[Math.floor(Math.random() * lightingMoods.length)];
            
            return `A ${angle} of a terrifying ${currentTraits.category || 'horror creature'}, rendered in photorealistic cinematic horror style. 
Physical appearance: ${currentTraits.physical || 'nightmarish features'}. 
The creature possesses ${currentTraits.powers || 'supernatural abilities'}.
Its demeanor is ${currentTraits.personality || 'menacing and otherworldly'}.
Setting: ${currentTraits.setting || 'dark atmospheric environment'}.
Atmosphere: ${lighting}, with ${currentTraits.sound || 'eerie ambiance'}.
Ultra detailed, 8K quality, dark fantasy horror aesthetic, volumetric lighting, cinematic composition, hyperrealistic textures.`;
        }

        // Create creature (with Pollinations.ai - FIXED)
        async function createCreature() {
            // Check if name exists
            if (!document.getElementById('creature-name-input').value) {
                generateName();
            }
            currentName = document.getElementById('creature-name-input').value || currentName;
            
            // Check if all traits are rolled
            const unrolled = Object.values(currentTraits).filter(v => v === null);
            if (unrolled.length > 0) {
                alert('Please roll all traits before creating your creature!');
                return;
            }

            // Show loading
            const imageContainer = document.getElementById('image-container');
            imageContainer.innerHTML = '<div class="loading-animation"></div>';
            
            // Generate biography
            generateBiography();
            
            // Generate AI image prompt
            const prompt = generateImagePrompt();
            console.log('üé® Generating Image with Prompt:', prompt);
            
            // Enhanced prompt for better horror creatures
            const enhancedPrompt = `${prompt}, highly detailed horror creature, dark cinematic atmosphere, professional concept art, 8k quality, terrifying monster design, photorealistic`;
            
            const negativePrompt = 'cartoon, anime, cute, cheerful, bright, colorful, low quality, blurry';
            
            const encodedPrompt = encodeURIComponent(enhancedPrompt);
            const encodedNegative = encodeURIComponent(negativePrompt);
            const seed = Math.floor(Math.random() * 1000000);
            
            // Pollinations.ai FREE API - with proper error handling
            currentImage = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=768&height=1024&seed=${seed}&nologo=true&negative=${encodedNegative}`;
            
            console.log('üîó Image URL:', currentImage);
            
            // Create image element with better error handling
            const img = new Image();
            
            img.onload = function() {
                console.log('‚úÖ Image loaded successfully!');
                imageContainer.innerHTML = '';
                imageContainer.appendChild(img);
                
                // Update result screen image if already showing
                if (document.getElementById('result').classList.contains('active')) {
                    document.getElementById('result-image').src = currentImage;
                }
            };
            
            img.onerror = function() {
                console.error('‚ùå Image failed to load');
                imageContainer.innerHTML = '<span class="placeholder-text">Image generation failed. Trying alternate method...</span>';
                
                // Try alternate loading method
                setTimeout(() => {
                    const imgRetry = document.createElement('img');
                    imgRetry.src = currentImage;
                    imgRetry.style.width = '100%';
                    imgRetry.style.height = '100%';
                    imgRetry.style.objectFit = 'cover';
                    
                    imgRetry.onload = () => {
                        imageContainer.innerHTML = '';
                        imageContainer.appendChild(imgRetry);
                        
                        // Update result screen image if already showing
                        if (document.getElementById('result').classList.contains('active')) {
                            document.getElementById('result-image').src = currentImage;
                        }
                    };
                    
                    imgRetry.onerror = () => {
                        imageContainer.innerHTML = '<span class="placeholder-text">Failed to generate. Please try "Create Creature" again.</span>';
                        alert('Image generation failed. Please click "Create Creature" again.');
                    };
                }, 2000);
            };
            
            // Set the source to start loading
            img.src = currentImage;
            img.alt = currentName;
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            
            // Show additional buttons immediately
            document.getElementById('regenerate-btn').style.display = 'block';
            document.getElementById('download-btn').style.display = 'block';
            
            // Show result screen immediately (image will load in background)
            showResult();
        }

        // Regenerate image only (with Pollinations.ai - FIXED)
        async function regenerateImage() {
            const imageContainer = document.getElementById('image-container');
            const resultImageContainer = document.getElementById('result-image-container');
            
            // Show loading in current view
            if (document.getElementById('result').classList.contains('active')) {
                resultImageContainer.innerHTML = '<div class="loading-animation"></div>';
            } else {
                imageContainer.innerHTML = '<div class="loading-animation"></div>';
            }
            
            // Generate AI image prompt
            const prompt = generateImagePrompt();
            console.log('üîÑ Regenerating with prompt:', prompt);
            
            const enhancedPrompt = `${prompt}, highly detailed horror creature, dark cinematic atmosphere, professional concept art, 8k quality, terrifying monster design, photorealistic`;
            
            const negativePrompt = 'cartoon, anime, cute, cheerful, bright, colorful, low quality, blurry';
            
            const encodedPrompt = encodeURIComponent(enhancedPrompt);
            const encodedNegative = encodeURIComponent(negativePrompt);
            const seed = Math.floor(Math.random() * 1000000);
            
            // Pollinations.ai FREE API
            currentImage = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=768&height=1024&seed=${seed}&nologo=true&negative=${encodedNegative}`;
            
            console.log('üîó New Image URL:', currentImage);
            
            // Create new image with better loading
            const img = new Image();
            
            img.onload = function() {
                console.log('‚úÖ Image regenerated successfully!');
                
                if (document.getElementById('result').classList.contains('active')) {
                    resultImageContainer.innerHTML = `<img src="${currentImage}" alt="${currentName}" id="result-image" style="width:100%;height:100%;object-fit:cover;">`;
                } else {
                    imageContainer.innerHTML = '';
                    const displayImg = document.createElement('img');
                    displayImg.src = currentImage;
                    displayImg.alt = currentName;
                    displayImg.style.width = '100%';
                    displayImg.style.height = '100%';
                    displayImg.style.objectFit = 'cover';
                    imageContainer.appendChild(displayImg);
                }
            };
            
            img.onerror = function() {
                console.error('‚ùå Image regeneration failed');
                const errorMsg = '<span class="placeholder-text">Failed to regenerate. Please try again.</span>';
                
                if (document.getElementById('result').classList.contains('active')) {
                    resultImageContainer.innerHTML = errorMsg;
                } else {
                    imageContainer.innerHTML = errorMsg;
                }
                
                alert('Failed to regenerate image. Please try again.');
            };
            
            // Start loading
            img.src = currentImage;
        }

        // Show result screen
        function showResult() {
            document.getElementById('creator').classList.remove('active');
            document.getElementById('result').classList.add('active');
            
            // Populate result screen
            document.getElementById('result-creature-name').textContent = currentName;
            document.getElementById('result-name-display').textContent = currentName;
            document.getElementById('result-image').src = currentImage;
            document.getElementById('biography-text').textContent = currentBio;
            
            // Populate attributes
            const attributesContainer = document.getElementById('attributes-container');
            attributesContainer.innerHTML = `
                <div class="attribute">
                    <h4>Category</h4>
                    <p>${currentTraits.category}</p>
                </div>
                <div class="attribute">
                    <h4>Tier</h4>
                    <p>${currentTraits.tier.name}</p>
                </div>
                <div class="attribute">
                    <h4>Physical Features</h4>
                    <p>${currentTraits.physical}</p>
                </div>
                <div class="attribute">
                    <h4>Origin</h4>
                    <p>${currentTraits.origin}</p>
                </div>
                <div class="attribute">
                    <h4>Powers & Abilities</h4>
                    <p>${currentTraits.powers}</p>
                </div>
                <div class="attribute">
                    <h4>Weakness</h4>
                    <p>${currentTraits.weakness}</p>
                </div>
                <div class="attribute">
                    <h4>Personality</h4>
                    <p>${currentTraits.personality}</p>
                </div>
                <div class="attribute">
                    <h4>Setting / Domain</h4>
                    <p>${currentTraits.setting}</p>
                </div>
                <div class="attribute">
                    <h4>Sound & Atmosphere</h4>
                    <p>${currentTraits.sound}</p>
                </div>
                <div class="attribute">
                    <h4>Signature</h4>
                    <p>${currentTraits.signature}</p>
                </div>
            `;
        }

        // Back to creator
        function backToCreator() {
            document.getElementById('result').classList.remove('active');
            document.getElementById('creator').classList.add('active');
            
            // Reset for new creation
            Object.keys(currentTraits).forEach(key => currentTraits[key] = null);
            document.querySelectorAll('.trait-value').forEach(el => {
                el.textContent = 'Click roll to begin...';
            });
            document.getElementById('creature-name-input').value = '';
            document.getElementById('preview-name').textContent = 'Unnamed Horror';
            document.getElementById('image-container').innerHTML = '<span class="placeholder-text">Your creature awaits...</span>';
            document.getElementById('regenerate-btn').style.display = 'none';
            document.getElementById('download-btn').style.display = 'none';
        }

       // Download card - saves an HTML file containing the creature card (tries to embed image)
async function downloadCard() {
    // helper: sanitize file name
    function safeFilename(name) {
        return (name || 'creature').replace(/[^a-z0-9_\-]/gi, '_').substring(0, 120);
    }

    // helper: try to fetch image and convert to data URL (returns null on failure)
    async function fetchImageAsDataURL(url) {
        if (!url) return null;
        try {
            const resp = await fetch(url, { mode: 'cors' });
            if (!resp.ok) throw new Error('Image fetch failed');
            const blob = await resp.blob();
            return await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        } catch (err) {
            console.warn('Could not embed image as data URL (CORS or network):', err);
            return null;
        }
    }

    // Build attributes HTML
    function buildAttributesHTML(traits) {
        if (!traits) return '';
        const fields = [
            {label: 'Category', value: traits.category || '‚Äî'},
            {label: 'Tier', value: traits.tier ? (traits.tier.name || traits.tier) : '‚Äî'},
            {label: 'Physical Features', value: traits.physical || '‚Äî'},
            {label: 'Origin', value: traits.origin || '‚Äî'},
            {label: 'Powers & Abilities', value: traits.powers || '‚Äî'},
            {label: 'Weakness', value: traits.weakness || '‚Äî'},
            {label: 'Personality', value: traits.personality || '‚Äî'},
            {label: 'Setting / Domain', value: traits.setting || '‚Äî'},
            {label: 'Sound & Atmosphere', value: traits.sound || '‚Äî'},
            {label: 'Signature', value: traits.signature || '‚Äî'}
        ];
        return fields.map(f => `<p><strong>${f.label}:</strong> ${f.value}</p>`).join('\n');
    }

    // Compose the HTML document
    const embedDataUrl = await fetchImageAsDataURL(currentImage);
    const imgSrc = embedDataUrl || (currentImage || '');
    const attributesHtml = buildAttributesHTML(currentTraits);
    const nameEscaped = currentName || 'Unnamed_Horror';
    const now = new Date().toISOString();

    const htmlDoc = `
/* üåô MOBILE-FRIENDLY FIXES */
@media (max-width: 900px) {
    .landing h1 {
        font-size: 3rem;
        letter-spacing: 0.1rem;
    }

    .landing p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
    }

    .start-btn {
        font-size: 1.2rem;
        padding: 1rem 2.5rem;
    }

    .creator-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
        padding: 1rem;
    }

    .traits-panel, .preview-panel {
        padding: 1.2rem;
    }

    .trait-section h3 {
        font-size: 1.1rem;
    }

    .trait-value {
        font-size: 0.9rem;
        min-height: 40px;
        padding: 0.8rem;
    }

    .roll-btn {
        font-size: 0.8rem;
        padding: 0.6rem 1rem;
    }

    .preview-card {
        max-width: 100%;
        padding: 1rem;
    }

    .creature-name {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .image-placeholder {
        height: 250px;
    }

    .action-buttons {
        flex-direction: column;
    }

    .create-btn, .regenerate-btn, .download-btn {
        font-size: 0.9rem;
        padding: 0.8rem;
    }

    .result-header h1 {
        font-size: 2.2rem;
    }

    .card-top {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .card-image {
        height: 300px;
    }

    .biography h3 {
        font-size: 1.1rem;
    }

    .biography p {
        font-size: 0.9rem;
        line-height: 1.5;
    }

    .attributes-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .attribute {
        padding: 1rem;
    }

    .result-buttons {
        flex-direction: column;
        gap: 0.8rem;
    }

    .result-btn {
        width: 100%;
        font-size: 1rem;
    }
}

@media (max-width: 500px) {
    .landing h1 {
        font-size: 2.2rem;
    }

    .landing p {
        font-size: 1rem;
    }

    .start-btn {
        font-size: 1rem;
        padding: 0.8rem 2rem;
    }

    .image-placeholder {
        height: 220px;
    }

    .preview-card {
        padding: 0.8rem;
    }

    .creator-header h1 {
        font-size: 2rem;
    }
}

</style>
</head>
<body>
<div class="card">
    <h1>${escapeHtml(currentName || 'Unnamed Horror')}</h1>
    <div class="image">${ imgSrc ? `<img src="${imgSrc}" alt="${escapeHtml(currentName || '')}">` : '<div style="padding:40px;text-align:center;color:#888">No image available</div>' }</div>
    <div class="bio">${escapeHtml(currentBio || '')}</div>
    <div class="attrs">
        ${attributesHtml}
    </div>
    <footer>Exported from Dark Genesis ‚Äî ${now}</footer>
</div>
</body>
</html>`.trim();

    // Create the blob and force download
    const filename = `DarkGenesis_${safeFilename(currentName)}.html`;
    const blob = new Blob([htmlDoc], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    // release object URL after short delay
    setTimeout(() => URL.revokeObjectURL(url), 10000);

    alert('Downloaded card: ' + filename + (embedDataUrl ? '\n\nImage embedded in file.' : '\n\nImage referenced by URL (embedding failed due to CORS).'));

    // small helper: escape HTML for interpolation
    function escapeHtml(str) {
        if (!str) return '';
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
    }
}

    </script>
</body>
</html>
